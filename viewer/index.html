<!DOCTYPE html>
<html>

<head>
    <title>VQA Sample Viewer</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .container {
            margin-top: 20px;
        }

        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .image-info {
            margin-left: 20px;
            width: 60%;
        }

        .navigation {
            margin-top: 20px;
        }

        #imageDisplay {
            max-width: 33%;
        }

        .field-name {
            font-weight: bold;
        }

        .input-group-container {
            display: flex;
        }

        .input-group-wrapper {
            flex-grow: 1;
        }

        #jsonPathSubmitButton {
            flex-basis: auto;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="text-center">VQA Sample Viewer</h2>
        <div class="input-group-container">
            <div class="input-group-wrapper">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">JSON File Path</span>
                    </div>
                    <input type="text" id="jsonPathInput" class="form-control" placeholder="Enter JSON file path">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Image Data Path</span>
                    </div>
                    <input type="text" id="dataPathInput" class="form-control" value="../data/Images/val/"
                        placeholder="Enter image data path">
                </div>
            </div>
            <button id="jsonPathSubmitButton" class="btn btn-primary mb-3 align-self-stretch">Load JSON</button>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <span class="field-name">Model Name:</span> <span id="modelName"></span><br>
                <span class="field-name">Metadata:</span> <span id="metadata"></span>
            </div>
        </div>
        <div class="image-container">
            <img id="imageDisplay" src="" alt="Image" class="img-thumbnail">
            <div class="image-info">
                <span class="field-name">Image ID:</span> <span id="imageId"></span><br>
                <span class="field-name">Question:</span> <span id="question"></span><br>
                <span class="field-name">Predicted Answer:</span> <span id="predictedAnswer"></span><br>
                <span class="field-name">Target Answer:</span> <span id="targetAnswer"></span>
            </div>
        </div>
        <div class="navigation">
            <button id="leftArrowButton" class="btn btn-secondary">&#8592;</button>
            <input type="number" id="currentIndexInput" class="form-control" style="width: 80px; display: inline;">
            <span id="totalItems"></span>
            <button id="rightArrowButton" class="btn btn-secondary">&#8594;</button>
        </div>
    </div>

    <script>
        let jsonData = null;
        let currentDataIndex = 0;
        let dataPath = '';
        document.getElementById('jsonPathSubmitButton').addEventListener('click', () => {
            const jsonPath = document.getElementById('jsonPathInput').value;
            dataPath = document.getElementById('dataPathInput').value;
            fetch(jsonPath)
                .then(response => response.json())
                .then(data => {
                    jsonData = data;
                    // Sort the data items by the "image_id" field in ascending order
                    jsonData.data.sort((a, b) => a.image_id.localeCompare(b.image_id));
                    currentDataIndex = 0;
                    document.getElementById('totalItems').textContent = '/' + jsonData.data.length;
                    displayData();
                })
                .catch(error => {
                    console.error('Error fetching JSON:', error);
                });
        });

        document.getElementById('leftArrowButton').addEventListener('click', () => {
            if (jsonData && currentDataIndex > 0) {
                currentDataIndex--;
                displayData();
            }
        });

        document.getElementById('rightArrowButton').addEventListener('click', () => {
            if (jsonData && currentDataIndex < jsonData.data.length - 1) {
                currentDataIndex++;
                displayData();
            }
        });

        document.getElementById('currentIndexInput').addEventListener('change', () => {
            const newIndex = parseInt(document.getElementById('currentIndexInput').value) - 1;
            if (jsonData && newIndex >= 0 && newIndex < jsonData.data.length) {
                currentDataIndex = newIndex;
                displayData();
            } else {
                alert('Index out of bounds!');
            }
        });

        function displayData() {
            if (!jsonData) return;
            const dataItem = jsonData.data[currentDataIndex];
            document.getElementById('imageDisplay').src = dataPath + dataItem.image_id + '.jpg';
            document.getElementById('imageId').textContent = dataItem.image_id;
            document.getElementById('question').textContent = dataItem.question;
            document.getElementById('predictedAnswer').textContent = dataItem.predicted_answer;
            document.getElementById('targetAnswer').textContent = dataItem.target_answer;
            document.getElementById('modelName').textContent = jsonData.model_name;
            document.getElementById('metadata').textContent = JSON.stringify(jsonData.metadata, null, 2);
            document.getElementById('currentIndexInput').value = currentDataIndex + 1;
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>